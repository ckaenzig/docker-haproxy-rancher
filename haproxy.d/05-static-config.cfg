resolvers rancher
    nameserver dnsmasq 169.254.169.250:53

listen admin
    bind *:8008
    stats enable
    stats uri /stats
    monitor-uri /.external_healthcheck

frontend entrypoint_80
    bind *:80
    redirect scheme https code 301

frontend entrypoint_443
    bind *:443 ssl crt /usr/local/etc/haproxy/certs/
    reqadd X-Forwarded-Proto:\ https

    use_backend varnish if { srv_is_up(varnish/cache) }
    default_backend sorry_page

frontend sorry_internal
    bind        127.0.0.1:8082
    use_backend sorry_page

backend varnish
    server cache 127.0.0.1:6083 send-proxy inter 2000 rise 2 fall 3 check
    server sorry 127.0.0.1:8082 backup

backend sorry_page
    http-response set-status 500
